<div class="container mx-auto px-4 py-8">
  <h1 class="text-3xl font-bold mb-6">Office Management Dashboard</h1>

  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
    <p-card header="Companies">
      <div class="text-center">
        <p class="text-4xl font-bold text-blue-600">{{ companyCount }}</p>
        <p class="text-gray-600">Total Companies</p>
      </div>
      <ng-template pTemplate="footer">
        <p-button label="View Companies" [routerLink]="['/companies']" icon="pi pi-building" [outlined]="true" />
      </ng-template>
    </p-card>

    <p-card header="Employees">
      <div class="text-center">
        <p class="text-4xl font-bold text-green-600">{{ employeeCount }}</p>
        <p class="text-gray-600">Total Employees</p>
      </div>
      <ng-template pTemplate="footer">
        <p-button label="View Employees" [routerLink]="['/employees']" icon="pi pi-users" [outlined]="true" />
      </ng-template>
    </p-card>

    <p-card header="Roles">
      <div class="space-y-2">
        <div class="flex justify-between">
          <span>Managers</span>
          <span class="font-bold">{{ roleCounts['Manager'] || 0  }}</span>
        </div>
        <div class="flex justify-between">
          <span>Admins</span>
          <span class="font-bold">{{ roleCounts['Admin'] || 0 }}</span>
        </div>
        <div class="flex justify-between">
          <span>Developers</span>
          <span class="font-bold">{{ roleCounts['Developer'] || 0 }}</span>
        </div>
      </div>
    </p-card>

    <p-card header="Real-time">
      <div class="text-center">
        <div class="mb-3">
          <div class="w-3 h-3 rounded-full inline-block mr-2"
            [ngClass]="{'bg-green-500': isConnected, 'bg-red-500': !isConnected}"></div>
          <span>{{ isConnected ? 'Connected' : 'Disconnected' }}</span>
        </div>
        <p class="text-sm text-gray-600">WebSocket Status</p>
      </div>
      <ng-template pTemplate="footer">
        <p-button label="Test Connection" icon="pi pi-refresh" (click)="testConnection()"
          [severity]="isConnected ? 'success' : 'danger'" />
      </ng-template>
    </p-card>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
    <p-card header="Quick Actions" class="h-full">
      <div class="space-y-4">
        <div class="space-x-4">
          <p-button label="Add New Company" icon="pi pi-plus" [routerLink]="['/companies/new']" class="w-full mb-2" />
          <p-button label="Add New Employee" icon="pi pi-user-plus" [routerLink]="['/employees/new']" class="w-full" />
        </div>
        <div>
          <p-button label="Refresh All Data" icon="pi pi-refresh" (click)="refreshData()" severity="secondary"
            class="w-full" />
        </div>
      </div>
    </p-card>

    <p-card header="Recent Activity" class="h-full">
      @if(loading){
      <div class="text-center py-4">
        <i class="pi pi-spin pi-spinner text-2xl"></i>
        <p class="mt-2">Loading...</p>
      </div>
      }
      @if(!loading){
      <div>
        @if(recentEmployees.length === 0){
        <p class="text-gray-500">No recent activity</p>
        }
        @for(employee of recentEmployees; track employee._id; let i = $index){
        <div class="border-b py-3 last:border-b-0">
          <div class="flex justify-between items-center">
            <div>
              <p class="font-semibold">{{ employee.firstName }} {{ employee.lastName }}</p>
              <p class="text-sm text-gray-600">{{ employee.role }} at {{ employee.company.name }}</p>
            </div>
            <span class="text-sm text-gray-500">{{ formatDate(employee.createdAt) }}</span>
          </div>
        </div>
        }
      </div>
      }
    </p-card>
  </div>
</div>